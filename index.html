<!DOCTYPE html>
<html lang="es" class="h-full bg-gray-900">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel de Moderadores - MithosMC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              accent: "#3B82F6",
              warning: "#FCD34D",
              severe: "#EF4444",
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .progress-ring__circle {
        transition: stroke-dashoffset 0.35s;
        transform: rotate(-90deg);
        transform-origin: 50% 50%;
      }
    </style>
  </head>
  <body class="h-full bg-gradient-to-br from-gray-900 to-gray-800">
    <div class="min-h-full flex flex-col">
      <header class="bg-gray-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
          <h1
            class="text-3xl sm:text-4xl font-bold tracking-tight text-white text-center"
          >
            Panel de Moderadores - MithosMC
          </h1>
        </div>
      </header>
      <main class="flex-grow">
        <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
          <div
            id="moderatorsGrid"
            class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
          >
            <!-- Las tarjetas de moderadores se generarán dinámicamente aquí -->
          </div>
        </div>
      </main>
      <footer class="bg-gray-800 mt-auto">
        <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
          <p class="text-center text-sm text-gray-400">
            &copy; 2024 MithosMC. Todos los derechos reservados.
          </p>
        </div>
      </footer>
    </div>

    <script>
      function calculateExpirationDate(sanctionDate, warnings, severeWarnings) {
        const date = new Date(sanctionDate);
        const months = warnings + severeWarnings * 3;
        date.setMonth(date.getMonth() + months);
        return date.toISOString().split("T")[0];
      }

      function calculateWarnings(normalWarnings, severeWarnings) {
        const totalNormalWarnings = normalWarnings % 3;
        const additionalSevere = Math.floor(normalWarnings / 3);
        const totalSevereWarnings = severeWarnings + additionalSevere;
        return {
          normalWarnings: totalNormalWarnings,
          severeWarnings: totalSevereWarnings,
        };
      }

      function createProgressRing(value, max, size, strokeWidth, color) {
        const radius = (size - strokeWidth) / 2;
        const circumference = radius * 2 * Math.PI;
        const offset = circumference - (value / max) * circumference;

        return `
                <svg class="w-full h-full" viewBox="0 0 ${size} ${size}">
                    <circle
                        cx="${size / 2}"
                        cy="${size / 2}"
                        r="${radius}"
                        stroke="#4B5563"
                        stroke-width="${strokeWidth}"
                        fill="transparent"
                    />
                    <circle
                        class="progress-ring__circle"
                        cx="${size / 2}"
                        cy="${size / 2}"
                        r="${radius}"
                        stroke="${color}"
                        stroke-width="${strokeWidth}"
                        stroke-linecap="round"
                        fill="transparent"
                        stroke-dasharray="${circumference}"
                        stroke-dashoffset="${offset}"
                    />
                    <text
                        x="50%"
                        y="50%"
                        text-anchor="middle"
                        dominant-baseline="central"
                        font-size="${size / 4}"
                        font-weight="bold"
                        fill="white"
                    >${value}/${max}</text>
                </svg>
            `;
      }

      function renderModeratorCards(moderators) {
        const grid = document.getElementById("moderatorsGrid");
        moderators.forEach((mod) => {
          const { normalWarnings, severeWarnings } = calculateWarnings(
            mod.warnings,
            mod.severeWarnings
          );
          const expirationDate = calculateExpirationDate(
            mod.sanctionDate,
            normalWarnings,
            severeWarnings
          );
          const card = document.createElement("div");
          card.className = `bg-gray-800 overflow-hidden shadow-lg rounded-lg border-2 ${
            severeWarnings >= 3 ? "border-red-600" : "border-gray-700"
          } transition-all duration-300 hover:shadow-2xl hover:scale-105`;
          card.innerHTML = `
                    <div class="p-6">
                        <div class="flex flex-col sm:flex-row items-center mb-6">
                            <img src="${mod.avatar}" alt="${
            mod.name
          }" class="w-24 h-24 rounded-full mb-4 sm:mb-0 sm:mr-6 border-4 border-accent shadow-lg">
                            <div class="text-center sm:text-left">
                                <h3 class="text-2xl font-semibold text-white">${
                                  mod.name
                                }</h3>
                                <p class="mt-1 text-lg text-accent font-medium">${
                                  mod.rank
                                }</p>
                            </div>
                        </div>
                        ${
                          severeWarnings >= 3
                            ? `
                            <div class="mt-4 bg-red-900 text-white p-4 rounded-md text-center animate-pulse">
                                <p class="font-bold text-lg">¡Advertencia!</p>
                                <p class="text-sm mt-1">Este moderador será bajado de rango por acumulación de advertencias graves.</p>
                            </div>
                        `
                            : ""
                        }
                        <div class="mt-6 grid grid-cols-2 gap-6">
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="w-24 h-24 mx-auto">
                                    ${createProgressRing(
                                      normalWarnings,
                                      3,
                                      100,
                                      8,
                                      "#FCD34D"
                                    )}
                                </div>
                                <p class="mt-3 text-sm font-medium text-center text-gray-300">Advertencias</p>
                            </div>
                            <div class="bg-gray-700 rounded-lg p-4">
                                <div class="w-24 h-24 mx-auto">
                                    ${createProgressRing(
                                      severeWarnings,
                                      3,
                                      100,
                                      8,
                                      "#EF4444"
                                    )}
                                </div>
                                <p class="mt-3 text-sm font-medium text-center text-gray-300">Adv. Graves</p>
                            </div>
                        </div>
                        <div class="mt-6 border-t border-gray-700 pt-4">
                            <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <dt class="text-sm font-medium text-gray-400">Fecha de Sanción</dt>
                                    <dd class="mt-1 text-sm text-white">${
                                      mod.sanctionDate
                                    }</dd>
                                </div>
                                <div>
                                    <dt class="text-sm font-medium text-gray-400">Fecha de Caducidad</dt>
                                    <dd class="mt-1 text-sm text-white">${expirationDate}</dd>
                                </div>
                            </dl>
                        </div>
                    </div>
                `;
          grid.appendChild(card);
        });
      }

      fetch("/data/sanciones.json")
        .then((response) => response.json())
        .then((data) => {
          renderModeratorCards(data);
        })
        .catch((error) => {
          console.error("Error al cargar los datos:", error);
          document.getElementById("moderatorsGrid").innerHTML =
            '<p class="text-red-500 text-center text-xl">Error al cargar los datos de los moderadores.</p>';
        });
    </script>
  </body>
</html>
